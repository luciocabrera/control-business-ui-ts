import{q as O,r as B,j as t,b as q,k as h,l as W,U as P,V as Q,F as j,f as w,A as _,K as R,W as L,g as $,B as G,D as X,X as H,I as N,o as Y,Y as J}from"./index-a0b9f4a7.js";import{r as e,u as Z}from"./vendor-2ae8ef6f.js";import{R as ee}from"./ReadOnlyTable-45e8a839.js";import{P as te}from"./PageSpinner-9a0c75ea.js";import"./swr-04965976.js";import{F as ie,E as se}from"./Form-41bf580f.js";import{C as oe}from"./CopyIcon-6c8dade6.js";import{N as ae}from"./NewIcon-1fb8d883.js";const ne="/assets/details_view-19416099.svg",re=()=>O({endpointUrl:B.products}),ce=()=>t("svg",{stroke:"rgb(157 34 34 / 77%)",fill:"rgb(157 34 34 / 77%)",strokeWidth:"0",viewBox:"0 0 24 24",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:q("g",{children:[t("path",{fill:"none",d:"M0 0h24v24H0z"}),t("path",{d:"M4 8h16v13a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V8zm2 2v10h12V10H6zm3 2h2v6H9v-6zm4 0h2v6h-2v-6zM7 5V3a1 1 0 0 1 1-1h8a1 1 0 0 1 1 1v2h5v2H2V5h5zm2-1v1h6V4H9z"})]})}),le=e.memo(({...i})=>{const[c,l]=h(y=>y.quantity),[g,x]=h(y=>y.priceUnit),[s,r]=h(y=>y.priceQuantity||0),[m]=W(y=>y.submittedCounter),b=e.useMemo(()=>({accessor:"quantity",label:"Quantity",type:"number",required:!0}),[]),v=e.useMemo(()=>m>0?P(b,c):[],[c,b,m]),C=e.useMemo(()=>Q(b,v),[v,b]),n=e.useMemo(()=>({accessor:"priceUnit",label:"Price Unit",type:"number",required:!0}),[]),F=e.useMemo(()=>m>0?P(n,g):[],[g,n,m]),u=e.useMemo(()=>Q(n,F),[F,n]),d=e.useMemo(()=>({accessor:"priceQuantity",label:"Price Quantity",type:"text",required:!0,readonly:!0}),[]),I=e.useMemo(()=>m>0?P(d,s):[],[s,d,m]),f=e.useMemo(()=>Q(d,I),[I,d]),p=e.useCallback(y=>{l({quantity:y.target.value}),r({priceQuantity:(y.target.value||0)*g})},[g,r,l]);return q(j,{children:[t(w,{onChange:p,textAlign:"right",...b,...i,...C,value:c},"field-input-quantity"),t(w,{onChange:y=>{x({priceUnit:y.target.value}),r({priceQuantity:c*(y.target.value||0)})},textAlign:"right",...n,...i,...u,value:g},"field-input-price-unit"),t(w,{onChange:()=>{},textAlign:"right",...d,...i,...f,value:_(s,"currency")},"field-input-price-quantity")]})}),we=e.memo(({...i})=>{const[c]=h(p=>p.subtotal),[l]=h(p=>p.taxes),[g]=h(p=>p.total),[x]=h(p=>p.taxesPercentage),[s]=W(p=>p.submittedCounter),r=e.useMemo(()=>({accessor:"subtotal",label:"Sub Total",type:"text"}),[]),m=e.useMemo(()=>s>0?P(r,c):[],[c,r,s]),b=e.useMemo(()=>Q(r,m),[m,r]),v=e.useMemo(()=>({accessor:"taxes",label:"Taxes",type:"text",required:!0}),[]),C=e.useMemo(()=>s>0?P(v,l):[],[l,v,s]),n=e.useMemo(()=>Q(v,C),[C,v]),F=e.useMemo(()=>({accessor:"taxesPercentage",label:"Taxes Percentage",type:"text"}),[]),u=e.useMemo(()=>({accessor:"total",label:"Total",type:"text",required:!0,readonly:!0}),[]),d=e.useMemo(()=>s>0?P(u,g):[],[g,u,s]),I=e.useMemo(()=>Q(u,d),[d,u]),f=e.useCallback(()=>null,[]);return q(j,{children:[t(w,{onChange:f,textAlign:"right",...r,...i,...b,value:_(c,"currency")},"field-input-subtotal"),t(w,{onChange:f,textAlign:"right",...F,value:`${x}%`},"field-input-taxes-percentage"),t(w,{onChange:f,textAlign:"right",...v,...i,...n,value:_(l,"currency")},"field-input-taxes"),t(w,{onChange:f,textAlign:"right",...u,...i,...I,value:_(g,"currency")},"field-input-total")]})}),ue=e.memo(({products:i,...c})=>{const[l,g]=h(a=>a.productId),[,x]=h(a=>a.priceUnit),[s,r]=h(a=>a.description),[m,b]=h(a=>a.date),[v]=h(a=>a.quantity),[,C]=h(a=>a.priceQuantity||0),n=R(m,"date",!0),F=e.useMemo(()=>i==null?void 0:i.map(a=>({label:a.nameWithCode,value:a.productId})),[i]),[u]=W(a=>a.submittedCounter),d=e.useMemo(()=>({accessor:"productId",label:"Product",type:"select",required:!0,options:F}),[F]),I=e.useMemo(()=>u>0?P(d,l):[],[l,d,u]),f=e.useMemo(()=>Q(d,I),[I,d]),p=e.useMemo(()=>({accessor:"description",label:"Description",type:"text",required:!0}),[]),y=e.useMemo(()=>u>0?P(p,s):[],[s,p,u]),S=e.useMemo(()=>Q(p,y),[y,p]),k=e.useMemo(()=>({accessor:"date",label:"Date",type:"date",required:!0}),[]),A=e.useMemo(()=>u>0?P(k,m):[],[m,k,u]),K=e.useMemo(()=>Q(k,A),[A,k]),o=e.useCallback(a=>{var E;const T=parseInt((E=a.target.options[a.target.selectedIndex])==null?void 0:E.value,10)||void 0,M=i==null?void 0:i.find(({productId:z})=>z===T);g({productId:T}),x({priceUnit:M==null?void 0:M.price}),C({priceQuantity:v*((M==null?void 0:M.price)||0)}),s||r({description:M==null?void 0:M.description})},[s,i,v,r,C,x,g]),D=e.useCallback(a=>{r({description:a.target.value})},[r]),U=e.useCallback(a=>{b({date:a.target.value})},[b]);return q(j,{children:[t(L,{onChange:o,value:l,...d,...c,...f},"field-select-product-id"),t(w,{onChange:D,...p,...c,...S,value:s},"field-input-description"),t(w,{onChange:U,...k,...c,...K,value:n},"field-input-carried-out")]})}),de=e.memo(({detail:i,onAcceptDetail:c,onFinish:l})=>{const{customerId:g}=Z(),x=g==="new"||!g,{data:s,isLoading:r}=re(),m=e.useCallback(C=>{const n=s==null?void 0:s.find(({productId:F})=>F===(typeof C.productId=="number"?C.productId:parseInt(C.productId,10)));c==null||c({...C,productNameWithCode:(n==null?void 0:n.nameWithCode)??"",productDescription:(n==null?void 0:n.description)??"",productPrice:(n==null?void 0:n.price)??0})},[c,s]),b=e.useMemo(()=>[{type:"row",fields:[{accessor:"",type:"object",render:()=>t(ue,{products:s})},{accessor:"",type:"object",render:()=>t(le,{})}]},{type:"rule",accessor:"date",label:"Date",rules:[{type:"required"}]},{type:"rule",accessor:"productId",label:"Product",rules:[{type:"required"}]},{type:"rule",accessor:"description",label:"Description",rules:[{type:"required"}]},{type:"rule",accessor:"quantity",label:"Quantity",rules:[{type:"required"}]},{type:"rule",accessor:"priceUnit",label:"Price",rules:[{type:"required"}]},{type:"rule",accessor:"priceQuantity",label:"Price Quantity",rules:[{type:"required"}]}],[s]);return r?t(te,{}):t($,{initialFields:b,initialData:i,children:t(ie,{icon:ne,title:`${x?"New":"Edit"} Detail`,onAccept:m,actions:t(G,{id:"invoice-details-actions-button-cancel",inverse:!0,onClick:l,children:"Cancel"}),onFinish:l,viewMode:!1,width:"650px"})})}),pe=({row:{original:{date:i}}})=>t(X,{date:i}),me=({row:{original:{quantity:i}}})=>t(H,{value:i,output:"number"}),ye=({row:{original:{priceUnit:i}}})=>t(H,{value:i,output:"currency"}),he=({row:{original:{priceQuantity:i}}})=>t(H,{value:i,output:"currency"}),ge=()=>e.useMemo(()=>[{accessorKey:"productNameWithCode",header:"Product"},{accessorKey:"date",header:"Date",cell:pe},{accessorKey:"description",header:"Description"},{accessorKey:"quantity",header:"Quantity",cell:me},{accessorKey:"priceUnit",header:"Price Unit",cell:ye},{accessorKey:"priceQuantity",header:"Price Quantity",cell:he}],[]),be="_icon_1uj4v_15",V={"label-wrapper":"_label-wrapper_1uj4v_1",icon:be,"actions-wrapper":"_actions-wrapper_1uj4v_25"},Pe=e.memo(({normalize:i})=>{const[c,l]=e.useState(!1),[g,x]=e.useState(),[s,r]=h(o=>o.details),[,m]=h(o=>o.subtotal),[,b]=h(o=>o.taxes),[v]=h(o=>o.taxesPercentage),[,C]=h(o=>o.total),n=ge(),F=e.useMemo(()=>(i==null?void 0:i(s))??s,[s,i]),u=e.useCallback(o=>{const D=o==null?void 0:o.reduce((T,M)=>T+M.priceQuantity,0),U=(D||0)*v/100,a=(D||0)+U;m({subtotal:D}),b({taxes:U}),C({total:a})},[m,b,C,v]),d=e.useCallback(o=>{const D=s.filter(U=>U!==o);r({details:D}),u(D)},[s,r,u]),I=e.useCallback(o=>{d(o),x(o),l(!0)},[d]),f=e.useCallback(o=>{x(o),l(!0)},[]),p=e.useCallback(()=>{x(void 0),l(!0)},[]),y=e.useCallback(o=>{const D=[...new Set([...s,o])];r({details:D}),u(D),l(!1)},[s,r,u]),S=e.useCallback(({row:{original:o}})=>q("div",{className:V["actions-wrapper"],children:[t(N,{id:"edit-invoice-detail",icon:t(se,{}),onClick:()=>I(o)}),t(N,{id:"copy-invoice-detail",icon:t(oe,{}),onClick:()=>f(o)}),t(N,{id:"delete-invoice-detail",icon:t(ce,{}),onClick:()=>d(o)})]}),[f,I,d]),k=e.useMemo(()=>[...n,{accessorKey:"",header:"Actions",sort:!1,enableResizing:!1,cell:S}],[n,S]),A=e.useCallback(()=>l(!1),[]),K=q("div",{className:V["label-wrapper"],children:[t("span",{children:"Details"}),t("div",{id:"icon-button",className:V.icon,children:t(N,{id:"new-invoice-detail",icon:t(ae,{}),onClick:p})})]});return q(j,{children:[q(Y,{id:"field-group-styled-invoice-details",children:[t("legend",{children:K}),t(ee,{data:F,columns:k,showHeader:!1})]},"table-form-field-invoice-details"),c&&t(J,{children:t(de,{detail:g,onAcceptDetail:y,onFinish:A})})]})});export{we as I,Pe as a,ne as d};
