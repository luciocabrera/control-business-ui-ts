import{j as e,c as B,d as W,e as F,f as P,g as q,i as K,b as h,F as G,H as J,T as Q,I as U,h as X}from"./index-a0b9f4a7.js";import{F as Y}from"./Form-41bf580f.js";import{r as i}from"./vendor-2ae8ef6f.js";import{u as Z,f as k,g as ee,a as te,b as ne,c as se}from"./@tanstack/react-table-e9a5a890.js";import"./swr-04965976.js";import{u as ie}from"./react-virtual-793d5da3.js";import{r as re}from"./@tanstack/match-sorter-utils-120d5a33.js";const oe=(r,g=1e3)=>{const n=i.useRef();return i.useEffect(()=>()=>{n.current&&clearTimeout(n.current)},[]),(...l)=>{const c=setTimeout(()=>{r(...l)},g);clearTimeout(n.current),n.current=c}},ze=()=>e("svg",{strokeWidth:"3",version:"1.1",viewBox:"0 0 64 64",xmlns:"http://www.w3.org/2000/svg",stroke:"currentColor",fill:"none",children:e("g",{children:e("g",{children:e("path",{d:"M32,12.625C14.878,12.625,1,32,1,32    s13.878,19.375,31,19.375S63,32,63,32S49.122,12.625,32,12.625z M32,43.625c-6.421,0-11.625-5.204-11.625-11.625    S25.579,20.375,32,20.375S43.625,25.579,43.625,32S38.421,43.625,32,43.625z"})})})}),E=({className:r})=>e("svg",{stroke:"currentColor",fill:"currentColor",className:r,strokeWidth:"0",viewBox:"0 0 1024 1024",height:"1em",width:"1em",xmlns:"http://www.w3.org/2000/svg",children:e("path",{d:"M880.1 154H143.9c-24.5 0-39.8 26.7-27.5 48L349 597.4V838c0 17.7 14.2 32 31.8 32h262.4c17.6 0 31.8-14.3 31.8-32V597.4L907.7 202c12.2-21.3-3.1-48-27.6-48zM603.4 798H420.6V642h182.9v156zm9.6-236.6l-9.5 16.6h-183l-9.5-16.6L212.7 226h598.6L613 561.4z"})}),le="_expander_1xtgt_165",ce="_resizer_1xtgt_181",ae="_isResizing_1xtgt_235",p={"table-wrapper":"_table-wrapper_1xtgt_1","header-wrapper":"_header-wrapper_1xtgt_143","header-icon":"_header-icon_1xtgt_157",expander:le,resizer:ce,"simple-td":"_simple-td_1xtgt_199",isResizing:ae},de=()=>{const{state:{columnFilters:r,showColumnFilters:g,columnMeta:n},dispatch:o}=B(),l=W(),c=i.useCallback(()=>{o({type:F.toggleShowColumnFilters})},[o]),z=i.useMemo(()=>r==null?void 0:r.reduce((s,d)=>({...s,[d.id]:d.value}),{}),[r]),b=i.useMemo(()=>n==null?void 0:n.map(s=>({accessor:s.id,label:s.name,type:s.type??"text",options:s.options})),[n]),R=i.useCallback(async s=>{try{const d=Object.keys(s).map(m=>({id:m,value:s[m]})).filter(m=>m.value);debugger;o({type:F.setColumnFilters,payload:{columnFilters:d}})}catch(d){console.error(d),l==null||l("Fields need to be checked","At least one problem has been found when validating the fields.","warning")}},[o,l]);return n.map(s=>e(P,{onChange:d=>{},accessor:"field-input-value",label:"Value",required:!0,type:"text"},"field-input-value")),g?e(q,{initialFields:b,initialData:z,children:e(Y,{title:"title",onAccept:R,viewMode:!1,height:"600px",width:"850px",onFinish:c})}):null},ue=(r,g,n,o)=>{const l=re(r.getValue(g),n);return o({itemRank:l}),l.passed},ge=({actions:r,columns:g,height:n,renderSubComponent:o,getRowCanExpand:l,dataHook:c,title:z,showHeader:b=!0,allowFiltering:R=!0})=>{var I,V;const[s,d]=i.useState([]),{state:{columnFilters:m,showColumnFilters:D},dispatch:w}=B(),j=i.useCallback(()=>{w({type:F.toggleShowColumnFilters})},[w]),C=K(c),x=i.useRef(null),{data:A,isLoading:y}=c,S=oe(()=>{var u;if(x.current){const{scrollHeight:t,scrollTop:f,clientHeight:N}=x.current;if(C){const{isReachingEnd:$}=c;t-f-N<300&&!y&&!$&&((u=c.setSize)==null||u.call(c,O=>O+1))}}},500);i.useEffect(()=>{S()},[S]),i.useEffect(()=>{w({type:F.setSorting,payload:{sorting:s}})},[w,s]);const _=Z({data:A,columns:g,filterFns:{fuzzy:ue},state:{columnFilters:m,sorting:s},manualFiltering:C,manualSorting:C,onSortingChange:d,getCoreRowModel:ee(),getFilteredRowModel:te(),getSortedRowModel:ne(),getExpandedRowModel:se(),getRowCanExpand:l,enableColumnResizing:!0,columnResizeMode:"onChange"}),{rows:v}=_.getRowModel(),H=ie({parentRef:x,size:v.length,overscan:10}),{virtualItems:a,totalSize:L}=H,M=a.length>0&&((I=a==null?void 0:a[0])==null?void 0:I.start)||0,T=a.length>0?L-(((V=a==null?void 0:a[a.length-1])==null?void 0:V.end)||0):0;return h(G,{children:[b&&e(J,{title:z,children:h(Q,{children:[r,R&&e(U,{id:"show-filters",onClick:j,icon:e(E,{})})]})}),y&&e(X,{}),D&&e(de,{}),e("div",{id:"table-wrapper",ref:x,style:{height:n},className:p["table-wrapper"],onScroll:S,children:h("table",{children:[e("thead",{children:_.getHeaderGroups().map(u=>e("tr",{children:u.headers.map(t=>h("th",{style:{width:t.getSize(),maxWidth:t.getSize()},children:[t.isPlaceholder?null:h("div",{onClick:t.column.getToggleSortingHandler(),className:p["header-wrapper"],children:[k(t.column.columnDef.header,t.getContext()),{asc:e("span",{children:"↑"}),desc:e("span",{children:"↓"})}[t.column.getIsSorted()]??null,t.column.getIsFiltered()?e(E,{className:p["header-icon"]}):null]}),t.column.getCanResize()&&e("div",{onMouseDown:t.getResizeHandler(),onTouchStart:t.getResizeHandler(),className:[p.resizer,p[t.column.getIsResizing()?"isResizing":""]].join(" ")})]},t.id))},u.id))}),h("tbody",{children:[M>0&&e("tr",{children:e("td",{style:{height:`${M}px`}})}),a.map(u=>{const t=v[u.index];return h(i.Fragment,{children:[e("tr",{ref:u.measureRef,children:t.getVisibleCells().map(f=>e("td",{className:p["simple-td"],children:k(f.column.columnDef.cell,f.getContext())},f.id))},`tr-${t.id}`),t.getIsExpanded()&&e("tr",{children:e("td",{colSpan:t.getVisibleCells().length,children:o==null?void 0:o({row:t})})},`expandable-tr-${t.id}`)]},t.id)}),T>0&&e("tr",{children:e("td",{style:{height:`${T}px`}})})]})]})})]})},be=i.memo(ge);export{be as R,ze as V};
