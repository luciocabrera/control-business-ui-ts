import{u as M,K as N,j as o,A as w,L as R,M as j,N as q,P as O,y as S,d as $,E as k,g as B,Q as G,R as K}from"./index-a0b9f4a7.js";import{r as p,u as Q,d as T}from"./vendor-2ae8ef6f.js";import{P as W}from"./PageSpinner-9a0c75ea.js";import{F as H,I as J}from"./Form-41bf580f.js";import"./swr-04965976.js";import{I as U,a as V}from"./InvoiceDetailsField-07452ad4.js";import"./styled-components-e6489abd.js";import"./use-context-selector-6b0b0676.js";import"./ReadOnlyTable-45e8a839.js";import"./@tanstack/react-table-e9a5a890.js";import"./react-virtual-793d5da3.js";import"./@tanstack/match-sorter-utils-120d5a33.js";import"./CopyIcon-6c8dade6.js";import"./NewIcon-1fb8d883.js";const X=({invoice:e,isCopying:m,taxesPercentage:u})=>{const{data:a,isLoading:r}=M(),t=p.useMemo(()=>a==null?void 0:a.map(s=>({label:`${s.fullNameWithInitials}`,value:s.peopleId})),[a]);return{fields:p.useMemo(()=>[{type:"row",label:"General",fields:[{type:"group",label:"General",fields:[{type:"row",fields:[{accessor:"invoice",label:"Invoice",type:"text",value:m||e==null?void 0:e.invoice,required:!0,rules:[{type:"length",value:6}]},{accessor:"date",label:"Date",type:"date",value:e==null?void 0:e.date,required:!0,normalize:s=>N(s,"date",!0)}]},{accessor:"customerId",label:"Customer",type:"select",value:e==null?void 0:e.customerId,options:t,required:!0}]},{type:"group",label:"Amounts",fields:[{type:"object",label:"Amounts",accessor:"",render:()=>o(U,{})}]},{type:"rule",accessor:"taxesPercentage",value:u},{accessor:"subtotal",type:"rule",value:e==null?void 0:e.subtotal,normalize:s=>w(s,"currency")},{accessor:"taxes",type:"rule",value:e==null?void 0:e.taxes,normalize:s=>w(s,"currency")},{accessor:"total",type:"rule",value:e==null?void 0:e.total,normalize:s=>w(s,"currency")}]},{type:"row",fields:[{accessor:"details",label:"details",type:"table",render:()=>o(V,{}),readonly:!0}]}],[t,e==null?void 0:e.customerId,e==null?void 0:e.date,e==null?void 0:e.invoice,e==null?void 0:e.subtotal,e==null?void 0:e.taxes,e==null?void 0:e.total,m,u])}},pe=()=>{const{invoiceId:e,action:m}=Q(),u=K(),a=e==="new"||!e,r=m==="copy"&&!a,{data:t,isLoading:F}=R(a?void 0:e),s=p.useMemo(()=>r&&t?{...t,invoiceId:void 0,invoice:""}:t?{...t}:{invoice:"",date:void 0,customerId:0,details:[],subtotal:0,total:0,taxes:0,taxesPercentage:u},[t,r,u]),x=j(),D=q(),A=O(),I=T(),y=S(),f=$(),{fields:C}=X({invoice:t,isCopying:r,taxesPercentage:u}),P=g=>g.map(({date:d,productId:l,description:i,quantity:b,priceUnit:h,priceQuantity:n})=>({date:d?new Date(d):new Date,description:i,quantity:b,priceUnit:h,priceQuantity:n,productId:typeof l=="string"?parseInt(l,10):l})),z=p.useCallback(async g=>{const d=a||r?void 0:parseInt(e,10),{customerId:l,date:i,details:b,...h}=g,n={invoiceId:d,date:i?new Date(i):new Date,customerId:typeof l=="string"?parseInt(l,10):l,details:P(b),...h};a||r?n.createdBy=1:n.updatedBy=1;try{const c=await A(n);[200,201].includes((c==null?void 0:c.status)||0)&&(await x(),D(d),y==null||y("success","Invoice successfully saved",`The Invoice ${t==null?void 0:t.invoice} has been successfully saved.`),I("/invoices"))}catch(c){const L=c;f==null||f(o(k,{errors:L.cause.errors}),"Error Saving Invoice","error")}},[f,y,t==null?void 0:t.invoice,e,r,a,I,A,D,x]),E=p.useCallback(()=>I("/invoices"),[I]);return(F||!C)&&!a?o(W,{}):o(B,{initialFields:C,initialData:s,children:o(H,{icon:o(J,{}),title:`${a||r?"New":"Edit"} Invoice`,onAccept:z,actions:o(G,{invoice:s}),onFinish:E,viewMode:!1,height:"612px",width:"1120px"})})};export{pe as default};
